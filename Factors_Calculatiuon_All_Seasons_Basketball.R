

setwd("C:/Users/skudriashov/Documents/Cotirovki/Machine_Learning/Basketball")
cot<-read.csv("Basketball_NBA_All_data.csv",sep=",",h=T)
cot$Date<-as.Date(cot$Date,"%m/%d/%Y")  
cot<-cot[with(cot,order(cot$Date)),]


result<-data.frame()

n<-5


for (i in 1:length(unique(cot$Season_Flag)))
{
  
  cot_2<-subset(cot, cot$Season_Flag==unique(cot$Season_Flag)[i])
  
  
  for (j in 1:nrow(cot_2))
  {
    
    
    
    # ???????????????????? ?????????????????? ???????????? ?????? 1 ??????????????
    
    cot_2$Match_T1_All[j]<-nrow(rbind(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))),
                                      subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))))
    
    # ???????????????????? ?????????????????? ???????????? ?????? 2 ??????????????
    
    cot_2$Match_T2_All[j]<-nrow(rbind(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))),
                                      subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))))
    
    
    # ???????????????????? ?????????????????? ???????????????? ???????????? ?????? 1 ??????????????
    
    cot_2$Match_T1_Home[j]<-nrow(subset(cot_2, cot_2$Date<cot_2$Date[j] & cot_2$Team_1==cot_2$Team_1[j]))
    
    
    # ???????????????????? ?????????????????? ???????????????? ???????????? ?????? 2 ??????????????
    
    
    cot_2$Match_T2_Guest[j]<-nrow(subset(cot_2, cot_2$Date<cot_2$Date[j] & cot_2$Team_2==cot_2$Team_2[j]))
    
  }
  
  
  
  
  ########################################################################## ???????? ####################################################################
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Points_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Points_1),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Points_2))/cot_2$Match_T1_All[j]
    
    
    
    
    # ???????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Points_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Points_2),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Points_1))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Points_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                            ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Points_1),
                               sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                            ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Points_2))/5
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Points_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                            ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Points_1),
                               sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                            ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Points_2))/5
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Points_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                             ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Points_1)/5
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Points_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Points_2)/5
    
    
    
  } 
  ##################################################################### ?????????????? ???????? ####################################################################
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_Goals_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Goal_1),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Goal_2))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_Goals_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Goal_1))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_Goals_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_1),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Goal_2))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_Goals_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Goal_1),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_2))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_Goals_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_1)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_Goals_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_2)/5
    
    
    
  }     
  ##################################################################### ?????????????????????? ???????? ####################################################################      
  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_Goals_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Goal_2),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Goal_1))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_Goals_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Goal_1),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Goal_2))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_Goals_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Goal_1))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_Goals_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_1))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_Goals_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_2)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_Goals_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_1)/5        
    
    
  }
  
  
  ##################################################################### ???????????? ####################################################################    
  
  ##################################################################### ???????????? 190 ?? ####################################################################     
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_190_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_190),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_190))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_190_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_190),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_190))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_190_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_190),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_190))/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_190_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_190),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_190))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_190_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_190)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_190_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_190)/5    
    
  }
  
  ##################################################################### ???????????? 200 ?? ####################################################################       
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_200_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_200),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_200))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_200_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_200),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_200))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_200_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_200),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_200))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_200_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_200),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_200))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_200_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_200)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_200_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_200)/5   
    
  }
  
  ##################################################################### ???????????? 210 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_210_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_210),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_210))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_210_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_210),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_210))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_210_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_210),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_210))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_210_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_210),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_210))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_210_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_210)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_210_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_210)/5    
    
  }
  
  
  ##################################################################### ???????????? 220 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_220_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_220),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_220))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_220_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_220),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_220))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_220_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_220),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_220))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_220_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_220),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_220))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_220_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_220)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_220_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_220)/5    
    
  }
  
  ##################################################################### ???????????? 230 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_230_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_230),
                                        sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_230))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_230_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_230),
                                        sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_230))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_230_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                    ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_230),
                                       sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_230))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_220_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                    ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_230),
                                       sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_230))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_230_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                             abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                     ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_230)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 4.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_230_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_230)/5    
    
  }
  
  
  ##################################################################### ???????????????????????????? ???????????? 0.5 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_0_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_0),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_0))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_0_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_0),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_0))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_0_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_0),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_0))/5 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_0_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_0),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_0))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_0_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_0)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_0_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_0)/5   
    
  }
  
  ##################################################################### ???????????????????????????? ???????????? 1.5 ?? #################################################################### 
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 1.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_1_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_1),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_1))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 1.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_1_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_1),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_1))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_1_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_1),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_1))/5
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_1_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_1),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_1))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_1_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_1)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_1_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_1)/5    
    
  }
  
  
  ##################################################################### ???????????? ####################################################################  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Total_Win_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_Defeat))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ?????????? ?????? 2 ?????????????? 
    
    
    cot_2$Total_Win_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_Defeat),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_Win))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_Win_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_Defeat))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10)) 
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_Win_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Defeat))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_Win_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Win)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_Win_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Defeat)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))   
    
  }  
  
  
  
  ##################################################################### ?????????????????? ####################################################################  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ?????????????????? ?????? 1 ??????????????        
    
    cot_2$Total_Defeat_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_Win))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ?????????????????? ?????? 2 ?????????????? 
    
    
    cot_2$Total_Defeat_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_Win),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_Defeat))/cot_2$Match_T2_All[j]   
    
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_Defeat_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_Win))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10))  
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_Defeat_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Win))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_Defeat_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                    ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Defeat)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_Defeat_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                             abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                     ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Win)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))    
    
  }
  
  
  
  ##################################################################### 1X ####################################################################  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ?????? 1 ??????????????        
    
    cot_2$Total_1X_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_1x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_2x))/cot_2$Match_T1_All[j]             
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ?????? 2 ?????????????? 
    
    
    cot_2$Total_1X_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_2x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_1x))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_1X_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_1x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_2x))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10)) 
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_1X_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_1x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_2x))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_1X_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_1x)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ???????????? ?? ???????????? 1?? = 1 ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_1X_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_2x)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))    
    
  }
  
  
  ##################################################################### 2X ####################################################################  
  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ?????? 1 ??????????????        
    
    cot_2$Total_2X_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_2x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_1x))/cot_2$Match_T1_All[j]              
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ?????? 2 ?????????????? 
    
    
    cot_2$Total_2X_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_1x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_2x))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_2X_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_2x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_1x))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10)) 
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_2X_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_2x),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_1x))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_2X_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_2x)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ???????????? ?? ???????????? 2?? = 1 ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_2X_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_1x)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))    
    
  }
  
  result<-rbind(result,cot_2) 
  
}


write.csv(result, "Factors_Calculation_Additional_Data_Test.csv")

