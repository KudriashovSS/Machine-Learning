setwd("W:/B2 Credit Risk/Methods and Model Development/_KUDRYASHOV_/Machine_Learning/SPORTS/Hockey")
data_RS_part1<-read_excel("NHL_SK_RS_Part1.xlsx")
data_RS_part2<-read_excel("NHL_SK_RS_Part2.xlsx")
data_PO<-read_excel("NHL_SK_PO_Part1.xlsx")

data<-data.frame(matrix(ncol = 24, nrow = 0))
colnames(data)<-c("#",	"Team",	"Game",	"GP",	"W",	"L",	"T",	"OT",	"P",	"GF",	"GA",	"S/O_Win",	
                  "S/O_Loss",	"SF",	"SA",	"PPG",	"Opp", "PP%",	"TS",	"PPGA",	"PK%",	"FOW",	"FOL",	"FOW%")


for (i in 1: (nrow(data_PO)/ncol(data)))
  
{
  
  for (j in 1:ncol(data))

    {
    
    data[i,j]<-data_PO$Text[ncol(data)*(i-1)+j]
    
    }
  
}

cot<-read.csv("NHL_Data_SK.csv",sep=";",h=T)
cot$Date<-as.Date(cot$Date,"%d.%m.%Y")  
cot<-cot[with(cot,order(cot$Date)),]

cot$Points_1<-ifelse(cot$Goal_1>cot$Goal_2 & cot$OT==0, 3, 
              ifelse(cot$Goal_1>cot$Goal_2 & cot$OT==1, 2,
              ifelse(cot$Goal_1==cot$Goal_2 & cot$P==2, 2, 
              ifelse(cot$Goal_1==cot$Goal_2 & cot$P==1, 1,
              ifelse(cot$Goal_1<cot$Goal_2 &  cot$OT==1, 1,0)))))
cot$Points_2<-ifelse(cot$Goal_1<cot$Goal_2 & cot$OT==0, 3, 
              ifelse(cot$Goal_1<cot$Goal_2 & cot$OT==1, 2,
              ifelse(cot$Goal_1==cot$Goal_2 & cot$P==1, 2, 
              ifelse(cot$Goal_1==cot$Goal_2 & cot$P==2, 1,
              ifelse(cot$Goal_1>cot$Goal_2 &  cot$OT==1, 1,0)))))
#cot$Flag_Win<-ifelse(cot$Goal_1>cot$Goal_2,1,0)
#cot$Flag_Draw<-ifelse(cot$Goal_1==cot$Goal_2,1,0)
#cot$Flag_Defeat<-ifelse(cot$Goal_1<cot$Goal_2,1,0)


cot$Total_more_5<-ifelse(cot$Goal_1+cot$Goal_2>5,1,0)
cot$Total_more_6<-ifelse(cot$Goal_1+cot$Goal_2>6,1,0)
cot$Total_more_7<-ifelse(cot$Goal_1+cot$Goal_2>7,1,0)

cot$Flag_Both_scored<-ifelse(cot$Goal_1>0 & cot$Goal_2>0,1,0)

cot$Flag_Ind_total_Team1_more_2<-ifelse(cot$Goal_1>2,1,0)
cot$Flag_Ind_total_Team2_more_2<-ifelse(cot$Goal_2>2,1,0)

cot$Flag_Ind_total_Team1_more_3<-ifelse(cot$Goal_1>3,1,0)
cot$Flag_Ind_total_Team2_more_3<-ifelse(cot$Goal_2>3,1,0)

cot$Flag_Ind_total_Team1_more_4<-ifelse(cot$Goal_1>4,1,0)
cot$Flag_Ind_total_Team2_more_4<-ifelse(cot$Goal_2>4,1,0)

cot$Flag_Ind_total_Team1_more_5<-ifelse(cot$Goal_1>5,1,0)
cot$Flag_Ind_total_Team2_more_5<-ifelse(cot$Goal_2>5,1,0)

result<-data.frame()

n<-5


#for (i in 1:length(unique(cot$Season_Flag)))
#{
  
  cot_2<-subset(cot, cot$Season_Flag==unique(cot$Season_Flag)[19])
  
  for (j in 1:nrow(cot_2))
  {
    
    
    
    # ???????????????????? ?????????????????? ???????????? ?????? 1 ??????????????
    
    cot_2$Match_T1_All[j]<-nrow(rbind(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))),
                                      subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))))
    
    # ???????????????????? ?????????????????? ???????????? ?????? 2 ??????????????
    
    cot_2$Match_T2_All[j]<-nrow(rbind(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))),
                                      subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))))
    
    
    # ???????????????????? ?????????????????? ???????????????? ???????????? ?????? 1 ??????????????
    
    cot_2$Match_T1_Home[j]<-nrow(subset(cot_2, cot_2$Date<cot_2$Date[j] & cot_2$Team_1==cot_2$Team_1[j]))
    
    
    # ???????????????????? ?????????????????? ???????????????? ???????????? ?????? 2 ??????????????
    
    
    cot_2$Match_T2_Guest[j]<-nrow(subset(cot_2, cot_2$Date<cot_2$Date[j] & cot_2$Team_2==cot_2$Team_2[j]))
    
  }
  
  
  
  
  ########################################################################## ???????? ####################################################################
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Points_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Points_1),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Points_2))/cot_2$Match_T1_All[j]
    
    
    
    
    # ???????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Points_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Points_2),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Points_1))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Points_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                            ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Points_1),
                               sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                            ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Points_2))/5
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Points_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                            ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Points_1),
                               sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                    abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                            ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Points_2))/5
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Points_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                             ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Points_1)/5
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Points_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Points_2)/5
    
    
    
  } 
  ##################################################################### ?????????????? ???????? ####################################################################
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_Goals_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Goal_1),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Goal_2))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_Goals_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Goal_1))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_Goals_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_1),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Goal_2))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_Goals_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Goal_1),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_2))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_Goals_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_1)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_Goals_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_2)/5
    
    
    
  }     
  ##################################################################### ?????????????????????? ???????? ####################################################################      
  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_Goals_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Goal_2),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Goal_1))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_Goals_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Goal_1),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Goal_2))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_Goals_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Goal_1))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_Goals_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Goal_2),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_1))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_Goals_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_2)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_Goals_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Goal_1)/5        
    
    
  }
  
  
  ##################################################################### ???????????? ####################################################################    
  
  ##################################################################### ???????????? 5 ?? ####################################################################     
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_5_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_5),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_5))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_5_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_5),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_5))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_5_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_5),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_5))/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_5_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_5),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_5))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_5_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_5)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 1.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_5_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_5)/5    
    
  }
  
  ##################################################################### ???????????? 6 ?? ####################################################################       
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_6_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_6),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_6))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_6_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_6),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_6))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_6_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_6),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_6))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_6_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_6),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_6))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_6_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_6)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 2.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_6_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_6)/5   
    
  }
  
  ##################################################################### ???????????? 7 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ?????? 1 ??????????????        
    
    cot_2$Total_more_7_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Total_more_7),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Total_more_7))/cot_2$Match_T1_All[j]           
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ?????? 2 ?????????????? 
    
    
    cot_2$Total_more_7_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Total_more_7),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Total_more_7))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Total_more_7_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_7),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Total_more_7))/5 
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_more_7_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Total_more_7),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_7))/5  
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_more_7_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Total_more_7)/5
    
    # ???????????????????? ???????????? ?? ?????????? ?????????? ???????????? 3.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_more_7_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                    ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Total_more_7)/5    
    
  }
  
  
  ##################################################################### ???????????????????????????? ???????????? 2 ?? ####################################################################   
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_2_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_2),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_2))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_2_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_2),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_2))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_2_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_2),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_2))/5 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_2_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_2),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_2))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_2_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_2)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_2_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_2)/5   
    
  }
  
  ##################################################################### ???????????????????????????? ???????????? 3 ?? #################################################################### 
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_3_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_3),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_3))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_3_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_3),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_3))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_3_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_3),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_3))/5 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_3_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_3),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_3))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_3_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_3)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_3_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_3)/5   
    
  }
  
  ##################################################################### ???????????????????????????? ???????????? 4 ?? #################################################################### 
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_4_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_4),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_4))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_4_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_4),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_4))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_4_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_4),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_4))/5 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_4_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_4),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_4))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_4_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_4)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_4_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_4)/5   
    
  }
  
  ##################################################################### ???????????????????????????? ???????????? 5 ?? #################################################################### 
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 1 ??????????????        
    
    cot_2$Ind_Total_more_5_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Ind_total_Team1_more_5),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Ind_total_Team2_more_5))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ?????? 2 ?????????????? 
    
    
    cot_2$Ind_Total_more_5_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Ind_total_Team2_more_5),
                                          sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Ind_total_Team1_more_5))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Ind_Total_more_5_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_5),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Ind_total_Team2_more_5))/5 
    
    # ???????????????????? ???????????? ?? ?????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Ind_Total_more_5_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                      ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_5),
                                         sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                              abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                      ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team1_more_5))/5  
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Ind_Total_more_5_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                               abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                       ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Ind_total_Team1_more_5)/5
    
    # ???????????????????? ???????????? ?? ???????????????????????????? ?????????????? ?????????? ???????????? 0.5 ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Ind_Total_more_5_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                                abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                        ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Ind_total_Team2_more_5)/5   
    
  }
  
  
  ##################################################################### ???????????? ####################################################################  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Total_Win_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_Defeat))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ?????????? ?????? 2 ?????????????? 
    
    
    cot_2$Total_Win_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_Defeat),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_Win))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_Win_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_Defeat))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10)) 
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_Win_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Defeat))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_Win_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Win)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ?????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_Win_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Defeat)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))   
    
  }  
  
  
  
  ##################################################################### ?????????????????? ####################################################################  
  
  for (j in 1:nrow(cot_2))
  { 
    
    # ???????????????????? ?????????????????? ?????? 1 ??????????????        
    
    cot_2$Total_Defeat_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$Flag_Win))/cot_2$Match_T1_All[j]            
    
    # ???????????????????? ?????????????????? ?????? 2 ?????????????? 
    
    
    cot_2$Total_Defeat_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$Flag_Win),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$Flag_Defeat))/cot_2$Match_T2_All[j]   
    
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ?????? ?????? 1 ??????????????
    
    cot_2$Total_Defeat_T1_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=10)  &               
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$Flag_Win))/min(min(cot_2$Match_T1_All[j],10),max(cot_2$Match_T1_All[j],10))  
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ?????? ?????? 2 ??????????????  
    
    cot_2$Total_Defeat_T2_10M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10) & 
                                                   ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$Flag_Defeat),
                                      sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=10)  &               
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Win))/min(min(cot_2$Match_T2_All[j],10),max(cot_2$Match_T2_All[j],10))  
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Total_Defeat_T1_10M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                            abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=10) & 
                                                    ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Flag_Defeat)/min(min(cot_2$Match_T1_Home[j],10),max(cot_2$Match_T1_Home[j],10))
    
    # ???????????????????? ?????????????????? ???? ?????????????????? 10 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Total_Defeat_T2_10M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                             abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=10) & 
                                                     ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$Flag_Win)/min(min(cot_2$Match_T2_Guest[j],10),max(cot_2$Match_T2_Guest[j],10))    
    
  }
  

  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_S_O_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$S.O_Win),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$S.O_Loss))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_S_O_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$S.O_Loss),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$S.O_Win))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_S_O_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$S.O_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$S.O_Loss))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_S_O_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$S.O_Win),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$S.O_Loss))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_S_O_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Goal_1)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_S_O_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$S.O_Loss)/5
    
    
    
  }  
  
  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_S_O_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$S.O_Loss),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$S.O_Win))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_S_O_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$S.O_Win),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$S.O_Loss))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_S_O_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$S.O_Loss),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$S.O_Win))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_S_O_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$S.O_Loss),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$S.O_Win))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_S_O_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$S.O_Loss)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_S_O_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$S.O_Win)/5        
    
    
  }
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_Shots_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$SF),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$SA))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_Shots_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$SA),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$SF))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_Shots_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$SF),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$SA))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_Shots_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$SF),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$SA))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_Shots_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$SF)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_Shots_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$SA)/5
    
    
    
  } 
  
  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_Shots_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$SA),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$SF))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_Shots_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$SF),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$SA))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_Shots_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$SA),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$SF))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_Shots_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$SA),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$SF))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_Shots_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$SA)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_Shots_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$SF)/5        
    
    
  }
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_PP_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$PPG),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$PPGA))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_PP_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$PPGA),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$PPG))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_PP_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$PPG),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$PPGA))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_PP_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$PPG),
                                   sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$PPGA))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_PP_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$PPG)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_PP_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                  ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$PPGA)/5
    
    
    
  } 
  

  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_PP_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$PPGA),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$PPG))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_PP_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$PPG),
                                     sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$PPGA))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_PP_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$PPGA),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$PPG))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_PP_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                                 ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$PPGA),
                                    sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                         abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                                 ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$PPG))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_PP_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                          abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                                  ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$PPGA)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_PP_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                           abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                   ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$PPG)/5        
    
    
  }
  

  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_PPO_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$Opp))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_PPO_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                             ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$Opp))/5

    

  }
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_PPO_Perc_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$PP.))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_PPO_Perc_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$PP.))/5
    
    
    
  }
  
  
  for (j in 1:nrow(cot_2))
  {
    
    # ???????????????????? ?????????????? ?????????? ?????? 1 ??????????????
    
    cot_2$Plus_FO_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$FOW),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$FOL))/cot_2$Match_T1_All[j]  
    
    # ???????????????????? ?????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Plus_FO_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$FOL),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$FOW))/cot_2$Match_T2_All[j]  
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Plus_FO_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                             ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$FOW),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                             ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$FOL))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Plus_FO_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                             ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$FOW),
                                sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                     abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                             ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$FOL))/5
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Plus_FO_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$FOW)/5
    
    
    # ???????????????????? ?????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Plus_FO_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                               ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$FOL)/5
    
    
    
  }
  
  for (j in 1:nrow(cot_2))
  {  
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 1 ??????????????        
    
    cot_2$Minus_FO_T1_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j])))))$FOL),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j])))))$FOW))/cot_2$Match_T1_All[j]       
    
    # ???????????????????? ?????????????????????? ?????????? ?????? 2 ??????????????
    
    
    cot_2$Minus_FO_T2_All[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j])))))$FOW),
                                  sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j])))))$FOL))/cot_2$Match_T2_All[j]
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 1 ??????????????
    
    cot_2$Minus_FO_T1_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$FOL),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T1_All-cot_2$Match_T1_All[j])<=5)  &               
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_1[j]))))$FOW))/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ?????? ?????? 2 ??????????????  
    
    cot_2$Minus_FO_T2_5M[j]<-sum(sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5) & 
                                              ((as.character(cot_2$Team_1)==as.character(cot_2$Team_2[j]))))$FOL),
                                 sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                      abs(cot_2$Match_T2_All-cot_2$Match_T2_All[j])<=5)  &               
                                              ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$FOW))/5          
    
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 1 ??????????????  
    
    cot_2$Minus_FO_T1_5M_Home[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                       abs(cot_2$Match_T1_Home-cot_2$Match_T1_Home[j])<=5) & 
                                               ((as.character(cot_2$Team_1)==as.character(cot_2$Team_1[j]))))$FOL)/5
    
    # ???????????????????? ?????????????????????? ?????????? ???? ?????????????????? 5 ???????????????? ?????? ?????? 2 ??????????????   
    
    cot_2$Minus_FO_T2_5M_Guest[j]<-sum(subset(cot_2, (cot_2$Date<cot_2$Date[j] & 
                                                        abs(cot_2$Match_T2_Guest-cot_2$Match_T2_Guest[j])<=5) & 
                                                ((as.character(cot_2$Team_2)==as.character(cot_2$Team_2[j]))))$FOW)/5        
    
    
  }
  
  result<-rbind(result,cot_2) 
  
}

result_prev<-read.csv("Factors_Calculation_NHL_SK.csv",sep=";",h=T)
result_prev$Date<-as.Date(result_prev$Date,"%d.%m.%Y") 

result_overall<-rbind(result_prev, result)

write.csv(result_overall, "Factors_Calculation_NHL_SK.csv", row.names = FALSE)
